(function(t){t.Watermarker=function(e,i){function a(e){"object"!=typeof e&&(e={}),h=t.extend(h,e),"function"!=typeof h.onChange&&(h.onChange=function(){}),"function"!=typeof h.onSelect&&(h.onSelect=function(){})}function n(){f.width(d.width()),f.height(d.height());var t=r(u.css("borderLeftWidth")),e=r(u.css("borderRightWidth")),i=r(u.css("borderTopWidth")),a=r(u.css("borderBottomWidth"));u.width(d.width()-t-e),u.height(d.height()-i-a)}function r(t){return parseInt(t.replace("px",""))}function o(){var t=c(f),e=c(p);h.onChange({x:t[0]-e[0],y:t[1]-e[1],w:f.width(),h:f.height(),opacity:h.opacity})}function c(e){var i=t(e).offset();return[i.left,i.top]}e=e,i=i;"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={});var s={watermark_img:"watermark.png",opacity:1,opacitySlider:null,x:null,y:null,w:null,h:null,position:null,onChange:function(){},onSelect:function(){}},h=s;a(i);var l=t(e),p=t("<div />").width(l.width()).height(l.height()).css({position:"relative"}).insertAfter(l);p.append(l);var d=t("<div />").resizable({resize:function(t,e){n(),o()},containment:"parent"}).draggable({drag:function(t,e){o()},containment:"parent"}).css({position:"absolute"}).insertAfter(l),u=t("<div />").addClass("watermark").css({position:"absolute","z-index":1});d.append(u);var f=t("<img />").attr("src",h.watermark_img).addClass("watermark").css({position:"relative","z-index":2});d.append(f),null!==h.opacitySlider&&h.opacitySlider.slider({min:0,max:100,value:100*h.opacity,slide:function(t,e){h.opacity=e.value/100,d.css({opacity:h.opacity,filter:"alpha(opacity="+100*h.opacity+")"}),o()}});var g,y,m=Math.round(l.width()/2-f.width()/2),w=Math.round(l.height()/2-f.height()/2),b=l.height()-f.height(),k=l.width()-f.width();if(null!=h.x&&null!=h.y)g=h.x,y=h.y;else if(null!=h.position)switch(h.position){case"topleft":g=0,y=0;break;case"topcenter":g=m,y=0;break;case"topright":g=k,y=0;break;case"centerleft":g=0,y=w;break;case"centercenter":case"center":default:g=m,y=w;break;case"centerright":g=k,y=w;break;case"bottomleft":g=0,y=b;break;case"bottomcenter":g=m,y=b;break;case"bottomright":g=k,y=b}else g=m,y=w;d.css({top:y+"px",left:g+"px"}),d.width(null==h.w?f.width():h.w),d.height(null==h.h?f.height():h.h),n(),d.css({opacity:h.opacity,filter:"alpha(opacity="+100*h.opacity+")"}),o()},t.fn.Watermarker=function(e){function i(i){var a=e.useImg||i.src,n=new Image;n.onload=function(){t.Watermarker(i,e)},n.src=a}return"object"!=typeof e&&(e={}),this.each(function(){if(t(this).data("Watermarker")){if("api"==e)return t(this).data("Watermarker");t(this).data("Watermarker").setOptions(e)}else i(this)}),this}})(jQuery);